---
# 优化systemd日志具体任务

- name: "【步骤 1】创建持久化目录 /var/log/journal 并授权"
  ansible.builtin.file:
    path: /var/log/journal
    state: directory
    owner: root
    group: systemd-journal
    mode: "2755"

- name: "【步骤 2】同步优化配置模板"
  ansible.builtin.template:
    src: journald.conf.j2
    dest: /etc/systemd/journald.conf
    owner: root
    group: root
    mode: "0644"
    backup: yes
  notify:
    - "重启journald服务"
    - "手动刷盘"
    - "重启journald服务"

- name: "【步骤 3】强制立即执行变更"
  ansible.builtin.meta: flush_handlers

- name: "【步骤 4】究极保险重启journald服务"
  ansible.builtin.systemd:
    name: systemd-journald
    state: restarted
